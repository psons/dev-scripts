
# 1. The Core Function: Resolves a link and exports the result
export_link_path() {
    local link_path="$1"
    local output_var="$2"
    local target_path=""

    # Validation: Check if it's a valid symlink
    if [ ! -L "$link_path" ]; then
        echo "Error: '$link_path' is not a symbolic link." >&2
        return 1
    fi

    # Resolution: Get absolute path (handles Linux & macOS)
    if command -v readlink >/dev/null 2>&1 && readlink -f "$link_path" >/dev/null 2>&1; then
        target_path=$(readlink -f "$link_path")
    else
        # macOS fallback using Python
        target_path=$(python3 -c "import os; print(os.path.realpath('$link_path'))")
    fi

    # Export: Set the variable in the environment
    eval "export $output_var='$target_path'"
    echo "Exported $output_var=$target_path"
}

# 2. The Wrapper: Finds a Homebrew package and exports its home
export_package_home() {
    local package_name="$1"
    local output_var="$2"
    
    # Validation: Use 'brew list' to ensure package is installed
    # We suppress output (> /dev/null) and checks exit code
    if ! brew list --versions "$package_name" > /dev/null; then
        echo "Error: Package '$package_name' is not installed via Homebrew." >&2
        return 1
    fi

    # Discovery: Find where Homebrew put the package symlink
    # (Homebrew keeps symlinks in the opt/ directory)
    local brew_path
    brew_path=$(brew --prefix "$package_name")

    # Execution: Pass to our core function to resolve and export
    export_link_path "$brew_path" "$output_var"
}
